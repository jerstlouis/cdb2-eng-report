[[threedcontent]]
== 3D Models and other 3D Content


This section discusses the proposal to use glTF to encode and store 3D models in the CDB X data store. This section also describes the prototype testing performed during the the <activity>. In CDB, 3D models are such phenomenon as trees (static), transmission towers, or helicopters (dynamic).

Currently, the OpenFlight specification is used to define all the 3D models in a CDB data store. The current OGC CDB 1.x core standard and https://portal.opengeospatial.org/files/16-009r4[Volume 6 CDB Rules for Encoding Data using OpenFlight] specifies all of the rules and requirements for using OpenFlight models in a CDB data store. The early advantage OpenFlight held over many 3d geometry model file formats (.obj, .dxf, .3ds) was its specific real-time 3d graphics industry design.

For CDB X, the particpants in the 3D Geospatial Series Tech Sprint II – OGC CDB 2.0 activity agreed that a more modern 3D model encoding and transmission format should be explored. Based on wide adoption and use in many domains, the Khronos glTF 2.0 specification was selected for further research and prototyping. A key part of this activity was to perform a detailed analysis of glTF functionality as compared to OpenFlight capabilities. The participants agreed that no (or as little as possible) funcitonality should be lost. NOTE: glTF will not be a replacement for OpenFlight in a CDB data store. Instead, glTF is recommended as the preferred encoding for CDB 3D Models. There are a few OpenFlight to glTF conversion tools.

The remainder of this section discusses the findings of the comparison as well as lessons learned from the prototyping activity.

=== Questions to be addressed

. Models be stored in GeoPackage (Editors Note: `Is this a good idea? One could store the glTF in the CDB data store without using GeoPackage - just as OpenFlight today. Need to think about also perhaps having I3S, 3D Tiles, CityGML and other encodings.`)
. Models preferred to be glTF (others allowed) (glb package?)
. Textures shall be xxxx format (png, jp2)  Power of 2 enforced?
. UV Map with model?
. naming convention tbd - should have some metadata use - indexing? directory path? layer? featureID?
. LOD Structure? (3d tiles?  MS LOD extenxtion for glTF) (Editors note: `Shouldn't the same LoD structure be used throughout CDB-X? Otherwise, things get confusing.`)
. Describe model placement

.. point features
..    Terrain Reconstruction
..    Elevation
..    Imagery
..    Areal features. (Editor's note: `We stopped using "aerial" in CDB 1.1 - changed to polygon.`)
..    linear features
. Is there a way to map glTF Material vs CDB physical material?

CDB catalog service for 3D tile inside a tile

=== Prototyping Experiments

Two profiles.

Profile 1 Storing the mesh in as 3D tile: Experiments

. Question: How to store LODs? In glTF extensions, In 3D tiles, in separate glTF
. Question: Are there missing glTF constructs?

Profile 2 Storing the mesh in as 3D tile (Editor's note: `Why just 3D Tiles? Why not a more general approach that allows other encodings/approaches?`)

. Question: What is the ability to source edit the mesh?
. Question: Mixing GeoPackage with 3D tiles?
. Question: CDB catalog service for 3D tile inside a tile

Both Profile 1 and Profile 2

. Question: What are the efficient format/packing for each different end-points:
.. ATAK
.. Mission command (wms/wfs)
.. Modsim
.. Gaming

3d-model-prototyping.png
[#img_3d-model-experiments,reftext='{figure-caption} {counter:figure-num}']
.Profles and Experiments for CBD-X 3D Models.
image::images/3d-model-prototyping.png[width=800,align="center"]


=== Description of 3D formats/encodings and References for this section:

==== OpenFlight

OpenFlight (or .flt) is an open, freely available 3d geometry model file format originally developed by Software Systems Inc. for its MultiGen real-time 3d modeling package. OpenFlight is a format supported widely in modeling and simulation community for dynamic and static 3D model. In CDB 1.x, OpenFlight is used for  the  representation  of  3D  dynamic  models  and  RGB  format  for  the  3D model’s textures. However, while widely used and there are extensive .flt model libraries, OpenFlight is long in the tooth.

https://portal.opengeospatial.org/files/90663[OpenFlight v16]

==== GL Transmission Format (glTF) 2.0

glTF is a royalty-free specification for the efficient transmission and loading of 3D scenes and models by applications. glTF uses the JSON standard. glTF is an API-neutral runtime asset delivery format developed by the Khronos Group 3D Formats Working Group.

https://github.com/KhronosGroup/glTF/tree/master/specification/2.0[glTF 2.0] GitHub repo and description.

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual[KHR_lights_punctual] is an extension that defines a set of lights for use with glTF 2.0. Lights define light sources within a scene.

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_lod[MSFT_lod] is an extension that adds the ability to specify various Levels of Detail (LOD) to a glTF asset.

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing[EXT_mesh_gpu_instancing] is an extension that is specfically designed to enable GPU instancing which renders many copies of a single mesh at once using a small number of draw calls. It's useful for things like trees, grass, road signs, etc. 

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/FB_geometry_metadata[FB_geometry_metadata] is an extension that annotates glTF scene objects with a summary of the cumulative geometric complexity and scene-space extents of the scene's associated scene graph. `Editors note: While the computed total vertex and primitive count are metadata this is very limited metadata and may not meet the needs of the CDB X community.`

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit[KHR_materials_unlit] is an extension that defines an unlit shading model for use in glTF 2.0 materials, as an alternative to the Physically Based Rendering (PBR) shading models provided by the core specification. 

https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform[KHR_texture_transform] is an extension that adds offset, rotation, and scale properties to textureInfo structures. These properties would typically be implemented as an affine transform on the UV coordinates. 
