[[Attribution]]

:figure-caption: Figure ATTPh3 -
:figure-num: 0

== CDB-X Attribution

One of the strengths of CDB as an interoperability standard, beyond the underlying geospatial standards it deploys, is the adoption of a controlled semantic vocabulary for feature types, attributes, and values. This approach - variously called a data model, a feature dictionary, or an entity catalog - is a necessary component of semantic interoperability between simulations. The feature attribution model goes beyond specifying the physical geometry, spatial referencing, and file formats used to represent the CDB data store to ensure simulations have a consistent and correlated deep understanding of the content semantics - to ensure a road is always a road, a lake is distinct from a river, width and height always has a consistent meaning, and so on. This semantic interoperability is necessary to ensure proper operation of simulation behaviors both for supporting human players and artificial intelligence agents.

The current CDB standard for attribution is primarily based on the officially obsolete DIGEST Feature Attribute Coding Catalogue (FACC) standard and has not integrated ongoing development and standards developed by other activities since OGC CDB 1.0. For several years, there have been discussions concerning how to modify the CDB standard to support newer feature attribution coding schemes and controlled vocabularies to go beyond the current approach. While the existing CDB standard theoretically supports representing other controlled vocabularies through modifying the CDB metadata XML (with some gaps identified in this report), at this time no changes to the CDB standard to adopt or promote other coding schemes has occured. This section provides 1.) information on the current approach in CDB 1.x, 2.) requirements for evolving the CDB standard to accommodate newer coding schems and 3.) the experimental framework and results from the work in the CDB-X activity.

=== Current CDB 1.x Attribution Approach

OGC CDB versions 1.x use a CDB Feature Data Dictionary (FDD) as the controlled vocabulary for attribution.  An Excel spreadsheet version of the CDB 1.X Feature Data Dictionary is available on the public https://external.ogc.org/twiki_public/pub/CDBswg/WebHome/CDB_FDD.xlsx[CDB wiki].

The CDB V1.x feature codes and subcodes are primarily based on the https://gwg.nga.mil/documents/asfe/DGIWG_FACC.htm[DIGEST Feature and Attribute Coding Catalog 2.1] (FACC) with additional concepts from a few other sources.  From that website: _FACC) specifies geospatial information concepts used by member nations of the multi-national Defence Geospatial Information Working Group (DGIWG) community. These concepts characterize aspects of real-world entities (or objects) and related properties, including those that are not necessarily visible or have a tangible physical form (e.g., airspace). The DGIWG FACC is a comprehensive dictionary and coding scheme for feature types, feature attributes (properties or characteristics associated with features), and attribute values (domain of feature attributes)._

[The abbreviations and acronyms are defined and/or expanded in the OGC CDB 1.x Standards and Best Practices documents]

In the FACC, each major feature category is further divided into subcategories identified by the second character of the five-character code containing an alphabetic value from "A" to "Z". Finally, the third, fourth, and fifth characters of the five-character feature code are a numeric value from 000 to 999. This value provides unique feature type identification within categories. Thus, all features must be identified by all five alphanumeric characters; e.g., the feature named "Building" is denoted by the code "AL015". Feature codes are listed in Annex A of the FACC Data Dictionary.

Each feature is associated with a textual description, which provides a human readable dictionary definition for the feature. Each Feature Code is also associated with a short human readable name. 

|===
|*Code*	|*Name*	|*Definition* 
|AA010 	|Mine 	|An excavation made in the earth for the purpose of extracting natural deposits. (See also AQ090)
|BB150 	|Landing Place 	|A place on shore where landing from the sea is possible.
|DB180 	|Volcano 	|A mountain or hill, often conical, formed around a vent in the earth's crust through which molten rock, ash, or gases are or have been expelled.
|FA001 	|Administrative Area 	|An area controlled by administrative authority.
|GB075 	|Taxiway 	|A prepared surface providing access to/from runways and the aircraft parking area, terminal area, or service area, etc.
|===

An OGC http://ogc.standardstracker.org/show_request.cgi?id=544[Change Request Proposal] (CRP) related to CDB attribution was generated during OGC Testbed 13:

`NOTE: An overview of the Testbed 13 activity is provided in the <<attrtestbed13, Background Section>> section of this ER.`

=== Ongoing Standards Development

DIGEST FACC, which was originally developed by the Defence Geospatial Intelligence Working Group (DGIWG) in June of 1991 based off of earlier standards, was most recently updated to the widely used 2.1 version in September of 2000. FACC was officially sunsetted (retired) by DGIWG on October 17, 2012 and by the NSG on December 31, 2012 after a long deprecation period. It was replaced by successor standards Digital Feature Data Dictionary (DFDD) and associated US National System for Geospatial Intelligence (NSG) National Feature Data Dictionary (NFDD). These successor standards were a largely compatible superset of the FACC codes and definitions, so many commercial and government tools and standards - including CDB 1.0 - largely continued with FACC despite it being officially retired. The successor standards did bring in additional definitions loosely inspired by ISO/IEC 18025:2005 and maritime definitions from  IHO ENC S-100. The NFDD standard eventually was reformulated into a more abstract NSG Core Vocabulary (NCV) and NSG Application Schema (NAS) which recast the existing standards in terms of logical data models expressed using the Unified Modeling Language (UML) and the semantic Web Ontology Language (OWL) vocabulary; strictly speaking both the DFDD and NFDD have been retired as well.

The US Army Geospatial Center codified the NAS 7.0 into a practical subset with encoding standards for Shapefiles and SQL databases, and this particular application schema became the Ground-Warfighter Geospatial Data Model (GGDM). Through a set of various NATO initiatives, the parallel DFDD eventually became the Defence Geospatial Information Model that also aligned with the NAS 7.0, albeit with more divergence. Subsequently, NSG has published an official NAS 8.0 update and follow-up quarterly updates with the most recent update being the NAS X-3 published on June 30, 2020. These updates introduce substantive changes to move away from legacy representations, separated out the traditional FACC 5-letter feature codes and 3-letter attribute codes into a separate "Platform Specific Model" document, and to align with OGC GML concepts. However, the core of NAS even today is still very recognizably derived from its distance FACC ancestor.

Directly relevant to this experiment is the selection of GGDM 3.0 as the basis for the US Army Synthetic Training Environment (STE) One World Terrain (OWT) data model in Octoboer 2019. The STE Cross-Function Team saw substantial benefits to moving toward NAS by using GGDM after verifying that the GGDM met the majority (over 90%) of current requirements for the existing SE Core use cases for the Army behaviors that were currently met by a different data model derived from ISO 18025, although substantial gaps for future use cases were identitied that were relevant to this experiment. Unlike the Army Geospatial Center use case for Shapefiles and GeoPackage SQLite tables for point, linear, and polygon features, the OWT use case primarily intends to deploy GGDM attribution attached to triangle mesh models at the mesh level, the vertex level, the triangle level, and applied to model surfaces via raster coverage texturing. The OWT 3D model approach is also relevant to notional glTF mesh layers and geotypical and geospecific models explored in other sections of this Engineering Report.

=== CDB-X Discussion and Requirements for CDB-X Experimentation

==== Experimentation Background

Migrating the CDB attribution to GGDM was an early improvement identified for CDB X based on input from current CDB stakeholders over a number of OGC CDB SWG meetings and the assessment and direction of the STE One World Terrain identified as being a desirable interoperability target. Greg Peele, one of the Tech Sprint participants, has described his work as a sub-contractor on the team recommending a Data Model for the U.S. Army One World Terrain (OWT) effort in multiple presentations to the OGC Interopable Simulation and Gaming Domain Working Group.  Greg's most recent - though slightly out of date relative to OWT development and this experiment - OGC presentation entitled *"Entities, Attributes, and Enumerants, Oh My!  Applying GGDM for Interoperable One World Terrain Semantics"* to the ISG DWG may be found here:
https://portal.ogc.org/files/?artifact_id=93666

The GGDM itself is, in practice, a selection of 624 feature types (with some duplicates for different geometry representation) with a set of associated attribution for each feature type. For attributes with a controlled set of values - also known as enumerants or codelists - the set of values is either explicitly enumerated with integer codes or externally referenced via a separate dictionary of text strings. In principle every GGDM feature type should match up to an NAS logical entity, every GGDM attribute should match up to an NAS attribute, and every GGDM enumerant should match up to an NAS listed value; all of these should then line up with vocabulary terms defined in the NCV. In practice, GGDM did augment the NAS with a small number of additional definitions integrated from the NGA Topographic Data Store (TDS) and the US Environmental Protection Agency Water Resource Database (WRDB). 

One substantial innovation of NAS and GGDM over earlier standards is moving from a flat table-based feature dictionary to a full logical data model, which allows for multi-valued attributes, range-valued attributes, complex attributes with named sub-fields, and relationships between features. The NAS logical data model expresses these innovations in pure UML without implementation guidance, while the GGDM defines an encoding to represent them in traditional table-based systems.

For multi-valued attributes, GGDM defines a separate attribute for each value, with the second value and so on suffixing the attribute name with the element index - e.g. for FFN "Feature Function", the first value would be FFN, the second value would be FFN2, the third value would be FFN3, and so on. GGDM sets a max cardinality of 3, but there is no technical reason why more values could not be used.

For range-valued attributes, GGDM splits them into three attribute values of upper, lower, and interval closure (an enumeration describing whether the lower and upper values are considered part of the range) - for example for WDA "Average Water Depth" you would have WDAL "Average Water Depth <lower bound>", WDAU "Average Water Depth <upper bound>", and WDAC "Average Water Depth <interval closure>" as three separate attributes.

Finally, for complex aggregate attributes and feature relationships, GGDM defines a scheme to take the logical value relationship as a hierarchy and flatten it into prefixed attributes that combine the datatype or feature type with the target attribute code; GGDM defines this flattening such that no attribute code exceeds 10 characters however so some particularly complex attributes have the prefixed names truncated. An example of a complex aggregate attribute is RIN_RTN "Route Identification <route designation>" - the NAS UML defines Route Identification as a separate class with a Route Designation attribute. An example of a feature relationship expressed as an attribute is ZI006_MEM "Note : Memorandum" which is a reference to a feature of type Note with an attribute value of Memorandum. In some cases the related features are fully embedded in the source feature and thus duplicated for every feature; in others the related feature is referenced by a foreign key using the UFI "Unique Entity Identifer" attribute.

Each of these three cases can also be combined with each other - for example, a multi-valued or range-valued attribute on a related feature, or a chain of multiple aggregated or related features - although doing so tends to quickly hit the 10 character truncation limit for the attribute code. While currently used for Shapefiles and GeoPackage implemetnations, this particular encoding scheme for complex attributes is not strictly necessary to claim GGDM conformance; directly representing multi-valued, range-valued, and complex attributes natively by some other mechanism such as JSON, binary markup, or separate SQL tables would still be considered compliant with the GGDM logical data model so long as the attribute semantics remains the same.

Given the historical lineage of the NAS and GGDM, there is a substantial overlap between GGDM and the DIGEST FACC standard integrated into CDB 1.0. However, neither standard is a strict superset of the other. NAS and GGDM have changed existing definitions inherited from FACC as well as adding many new definitions. CDB has made substantive changes to add a new concept of "Feature Subcode" that did not exist in prior standards, bring in a different se of definitions from ISO 18025, and add new definitions for aeronautics and building interior components. STE One World Terrain, in particular, had identified gaps in the GGDM standard for building interiors, aeronautics, vegetation, and materials which are all current CDB use cases, so the existing CDB extensions over FACC may end up being complementary to GGDM rather than redundant.

==== Experimentation Goals

Given the strong consensus that GGDM represents an appropriate path forward for CDB X, we planned an experiment to validate this hypothesis and determine what gaps and difficulties this change would introduce, with a particular focus on any changes in CDB storage structure would be implied by moving to GGDM. During the initial Phase 3 of the CDB X Tech Sprint, we created an initial metamodel describing the proposed schema for representing the target GGDM data model and a notional SQLite metadata encoding to store it in a more runtime-efficient way than the current CDB 1.0 XML metadata.

The first planned experiment was to create a prototype software code library representing the proposed CBD X feature dictionary metamodel. This prototype would define runtime classes for each of the metamodel concepts and implement a proof of concept reader that could load both the existing CDB 1.0 XML feature and attribute dictionary metadata as well as loading the GGDM 3.0 entity catalog as conventionally formatted in an Excel spreadhseet. The prototype would then finally implement proof of concept support for storing the dictionary content in the proposed SQLite metadata encoding, with a stretch goal of also implementing sample XML and JSON encodings for comparison. The primary goal of the first experiment was not necessarily to fully implement all of the capabilities, but rather use the prototype to identify and document any deficiences or mismatches in the proposed CDB X feature dictionary metamodel - ideally with proposed corrections - that would interfere with migrating existing CDB 1.0 feature data or representing the proposed GGDM 3.0 dictionary.

Since CDB 1.0 and GGDM have essentially compatible semantics of what a feature type is, the next phase of the experiment was to assess data model mappings between GGDM, TDS, and CDB to determine how cleanly the existing CDB feature types translate to GGDM feature types and identify any substantial gaps in GGDM as well as mappings that lose precision or involve additional complexity. We are particularly interested in identifying how much of the mapping preserves the existing CDB feature code, feature name, or ideally both. We also plan to use the gaps identified to suggest a mitigation strategy for filling those gaps either using existing CDB 1.0 definitions or from other open standards. In this experiment we also planned to examine similar efforts conducted by SE Core and STE One World Terrain. While initial assessments suggested that attribution and enumerant values would likely map mostly directly due to both CDB and GGDM largely pulling from the same FACC ancestry, we also planned to document any mismatches we found regarding attribute values. Ideally, as a stretch goal, we planned to adapt the prototype software library developed for the first experiment to use name and code matching to generate an automated mapping to compare with the manual assessment.

The third "experiment" is more of a thought experiment to coordinate with the tiling, vector features, and 3D model breakout groups to identify what changes to the feature dictionary and data model will imply on changes to structure and content of the CDB datasets. This will identify the key areas of standards development for attribution outside of the feature dictionary metadta itself. It may also inspire changes to the CDB datasets to better align with the target GGDM data model.

=== CDB X Experiment Findings
==== Entity Metamodel Comparison

==== Feature Subcodes not in GGDM

==== Mapping between CDB, TDS, and GGDM

==== Grouping Features into Datasets and Categories

==== Per-Entity vs. Per-Dataset Attributes

==== Existing FDD Metadata Missing Needed Definitions

==== Mandatory vs. Optional Attributes and Default Values

==== Advanced Attribute Constraints and CDB Validation

==== Instance, Class, and Extended Attributes

==== CDB Vector Geometry Data Model vs. Other OGC Standards

==== CDB Attribute Model vs. Other OGC Standards

==== Entity Dictionary Storage Design

==== Organizing Attributes by Domain

==== Data Dictionary Versioning, Changes, and Extensions

==== Impacts of Attribution Changes on Vector Encoding

==== Impacts of Attribution Changes on 3D Models

==== Feature-level Metadata

==== Relationship to Light Points

==== Relationship to Materials

==== Building Interior Considerations

=== CDB X Attribution Preliminary Design
. Updated graphic showing Miro whiteboard plan, modified by experiment findings

=== Future Work on Attribution
. Compile CDB feature types missing in NAS/NCV into new vocabulary definitions (aeronautics, building interiors, vegetation)
. Conduct detailed mapping of attributes and enumerants
. Detailed mappings correlating CDB feature subcodes to attributes and enumerants where possible
. Create design and format for machine-readable mapping translation rules to provide easy migration path for existing CDBs to GGDM
. Identify what could be done in CDB 1.3 as backward compatible changes to XML and Vector datasets

==== Some questions to be addressed during experimentation

. GGDM/NAS define standard layers that subdivide vector features into semantic sets (i.e. hydrology, industry, extraction, etc.). Is this meaningful to CDB? Or is it irrelevant?
. GGDM can be cross walked to NGA TDS 7.1. What are the missing attributes between M&S and TDS?
. Is there a challenge on the Sim for reading Feature Codes Vs Attribution?
. What are the format implications: vector and mesh formats must support GGDM attribution and entity types?
. Metadata: GGDM defines metadata as attributes. Encoding decision: separate metadata table referenced from features via foreign key? Or flattened metadata attributes present on every feature?
. GGDM does not have mandatory attribution fields. All fields are optional. What are the implications?
. What attribution is missing from GGDM for CDB?

==== Phase 3, Day 3

[#img_Peele_Whiteboard_Day_3,reftext='{figure-caption} {counter:figure-num}']
.Greg Peele's Whiteboard from Phase 3 Day 3.
image::images/Greg Peele Day 3 whiteboard.png[width=1000,align="center"]

==== Phase 3, Day 4

[#img_Attribution-in-GGDM-prove-me-wrong,reftext='{figure-caption} {counter:figure-num}']
.'Attribution will be in GGDM, Prove me Wrong' Day 4 Sign.
image::images/Day 4 Attribution in GGDM Prove me Wrong sign.png[width=500,align="center"]

[#img_Attribution-Day-4-Whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 4 Whiteboard.
image::images/Attribution Day 4 Sub Team Whiteboard 1.png[width=1000,align="center"]

==== Phase 3, Day 5

[#img_Attribution-Day-5-WIP1-Whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 5 Work in Progress Whiteboard One.
image::images/Day 5 Attribution Whiteboard WIP1.png[width=1000,align="center"]

[#img_Attribution-Day-5-WIP2-whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 5 Work in Progress Whiteboard Two.
image::images/Day 5 Attribution Whiteboard WIP2.png[width=1000,align="center"]

= Plan for Experimentation in subsequent phases
