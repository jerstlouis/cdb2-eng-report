[[Attribution]]

:figure-caption: Figure ATTPh3 -
:figure-num: 0

== CDB-X Attribution

One of the strengths of CDB as an interoperability standard, beyond the underlying geospatial representation standards it deploys, is the adoption of a controlled semantic vocabulary for feature types, attributes, and values. This approach - variously called a data model, a feature dictionary, or an entity catalog - is a necessary component of semantic interoperability between simulations. The feature attribution model goes beyond specifying the physical geometry, spatial referencing, and file formats used to represent the CDB data store to ensure simulations have a consistent and correlated deep understanding of the content semantics - to ensure a road is always a road, a lake is distinct from a river, width and height always has a consistent meaning, and so on. This semantic interoperability is necessary to ensure proper operation of simulation behaviors both for supporting human players and artificial intelligence agents.

The current CDB standard for attribution is primarily based on the officially obsolete DIGEST Feature Attribute Coding Catalogue (FACC) standard and has not integrated ongoing development and standards developed by other activities since OGC CDB 1.0. For several years, there have been discussions concerning how to modify the CDB standard to support newer feature attribution coding schemes and controlled vocabularies to align with current standards and best practices. While the existing CDB standard theoretically supports representing other controlled vocabularies through modifying the CDB metadata XML (with some gaps identified in this report), at this time no changes to the CDB standard to adopt or promote other coding schemes has occured. This section provides 1.) information on the current approach in CDB 1.x, 2.) requirements for evolving the CDB standard to accommodate newer coding schems and 3.) the experimental framework and results from the work in the CDB-X activity.

=== Current CDB 1.x Attribution Approach

OGC CDB versions 1.x use a CDB Feature Data Dictionary (FDD) as the controlled vocabulary for attribution.  An Excel spreadsheet version of the CDB 1.X Feature Data Dictionary is available on the public https://external.ogc.org/twiki_public/pub/CDBswg/WebHome/CDB_FDD.xlsx[CDB wiki].

The CDB 1.x feature codes and subcodes are primarily based on the  https://www.dgiwg.org/DIGEST[DIGEST Feature and Attribute Coding Catalog 2.1] (FACC) with additional concepts from a few other sources notably https://standards.sedris.org/18025[ISO 18025 EDCS].  From that website: _FACC) specifies geospatial information concepts used by member nations of the multi-national Defence Geospatial Information Working Group (DGIWG) community. These concepts characterize aspects of real-world entities (or objects) and related properties, including those that are not necessarily visible or have a tangible physical form (e.g., airspace). The DGIWG FACC is a comprehensive dictionary and coding scheme for feature types, feature attributes (properties or characteristics associated with features), and attribute values (domain of feature attributes)._

[The abbreviations and acronyms are defined and/or expanded in the OGC CDB 1.x Standards and Best Practices documents]

In the FACC, each major feature category is further divided into subcategories identified by the second character of the five-character code containing an alphabetic value from "A" to "Z". Finally, the third, fourth, and fifth characters of the five-character feature code are a numeric value from 000 to 999. This value provides unique feature type identification within categories. Thus, all features must be identified by all five alphanumeric characters; e.g., the feature named "Building" is denoted by the code "AL015". Feature codes are listed in Annex A of the FACC Data Dictionary.

Each feature is associated with a textual description, which provides a human readable dictionary definition for the feature. Each Feature Code is also associated with a short human readable name. 

|===
|*Code*	|*Name*	|*Definition* 
|AA010 	|Mine 	|An excavation made in the earth for the purpose of extracting natural deposits. (See also AQ090)
|BB150 	|Landing Place 	|A place on shore where landing from the sea is possible.
|DB180 	|Volcano 	|A mountain or hill, often conical, formed around a vent in the earth's crust through which molten rock, ash, or gases are or have been expelled.
|FA001 	|Administrative Area 	|An area controlled by administrative authority.
|GB075 	|Taxiway 	|A prepared surface providing access to/from runways and the aircraft parking area, terminal area, or service area, etc.
|===

An OGC http://ogc.standardstracker.org/show_request.cgi?id=544[Change Request Proposal] (CRP) related to CDB attribution was generated during OGC Testbed 13:

`NOTE: An overview of the Testbed 13 activity is provided in the <<attrtestbed13, Background Section>> section of this ER.`

=== Ongoing Standards Development

DIGEST FACC, which was originally developed by the Defence Geospatial Intelligence Working Group (DGIWG) in June of 1991 based off of earlier standards, was most recently updated to the widely used 2.1 version in September of 2000. FACC was officially sunsetted (retired) by DGIWG on October 17, 2012 (see http://portal.dgiwg.org/files/7827[disposition here]) and by the NSG on December 31, 2012 (see https://gwg.nga.mil/documents/asfe/DGIWG_FACC.htm[disposition here]) after a long deprecation period. FACC was replaced by successor standards DGIWG Feature Data Dictionary (DFDD) and associated extension US National System for Geospatial Intelligence (NSG) National Feature Data Dictionary (NFDD). These successor standards were a largely compatible superset of the FACC codes and definitions that did not make any fundamental architecture changes. As a consequence, many commercial and government tools and standards - including CDB 1.0 - continued with FACC 2.1 despite it being officially retired.

The successor standards did bring in additional definitions loosely inspired by https://standards.sedris.org/18025/[ISO/IEC 18025:2005 EDCS] and maritime definitions from  https://iho.int/uploads/user/pubs/standards/s-57/31Main.pdf[IHO ENC S-57]. The NFDD standard eventually was reformulated into the https://nsgreg.nga.mil/voc/registers.jsp?register=NCV[NSG Core Vocabulary (NCV)] and https://nsgreg.nga.mil/doc/view?i=5042[NSG Application Schema (NAS)] which recast the existing standards in terms of logical data models expressed using the Unified Modeling Language (UML) in compliance with the https://www.iso.org/obp/ui/#iso:std:iso:19109:ed-2:v1:en[ISO 19109:2015 Geographic Information Rules for Application Schemas] and the semantic https://www.w3.org/OWL[Web Ontology Language (OWL)] vocabulary; both the DFDD and NFDD have been retired as well. 

The current NAS specification also introduced substantial vocabulary changes describing the metamodel itself. The most substantial change is that the term "feature" was generalized into the more abstract term "entity" to accommodate vehicles, lifeforms, devices, and abstract ideas like metadata and statistics. The term "enumeration" is still in use to describe a controlled vocabulary of attribute values, but the alternate term "codelist" is also used and the actual values themselves are generally referred to as "listed values." The NAS also introduced a new conceptual model for relating different entities through "associations" - such associations themselves are also entities that mediate complex relationships between entities.

The US Army Geospatial Center codified the https://nsgreg.nga.mil/doc/view?i=3029[NAS 7.0] reformulation of NFDD into a practical subset targeted at the mission of outdoor environments for the ground warfighter, with encoding standards accommodating limitations of Shapefiles and SQL databases in implementing the general NAS model: this particular application schema became the https://ggdm.erdc.dren.mil/pages/contents/v3.0.html[Ground-Warfighter Geospatial Data Model (GGDM)]. Through a set of various NATO initiatives, the parallel DFDD eventually became the https://www.dgiwg.org/dgiwg-standards/205[Defence Geospatial Information Model (DGIM)] that also aligned with the NAS 7.0 and considerably overlapped with and took inspiration from GGDM 3.0, albeit with more divergence. The DGIM extended the NAS with some additional definitions from ongoing data model development for the maritime https://iho.int/en/s-100-universal-hydrographic-data-model[IHO ENC S-100 Universal Hydrographic Data Model] and the https://www.aixm.aero[Aeronautical Information Exchange Model (AIXM)] which may be of substantial relevance to CDB for addressing any gaps found in the NAS.

Concurrently, NSG has published an official https://nsgreg.nga.mil/doc/view?i=3031[NAS 8.0] update - the current officially mandated standard - and follow-up quarterly updates to address errata, add extensions, and reformulate documentation. The most recent update at the time of writing is the https://nsgreg.nga.mil/doc/view?i=5042[NAS X-3] published on June 30, 2020. These updates introduced substantive changes to move away from legacy representations, separated out the traditional FACC 5-letter feature codes and 3-letter attribute codes into a separate "Platform Specific Model" document, separated out view assignments to a separate document, and added definitions for OGC GML concepts. However, the core of NAS today is still recognizably derived from its distant FACC ancestor and still has substantial overlap with it.

A full diagram of the lineage of various geographic information standards is presented here as developed by Geometric Progress LLC for the STE One World Terrain Data Model Working Group. <TODO>

Directly relevant to this experiment is the adoption of NAS compliance as a design goal and the selection of GGDM 3.0 as the starting point to meet that goal for the US Army Synthetic Training Environment (STE) One World Terrain (OWT) data model in October 2019. The STE Cross-Function Team saw substantial benefits to moving toward NAS by using GGDM after verifying that the GGDM link:++Experiments/Attribution/SE Core to GGDM Gaps.xlsx++[met over 90% of current requirements for the existing SE Core use cases] for the Army behaviors that were currently met by the existing SE Core Environment Data Model based on https://standards.sedris.org/18025[ISO 18025], although substantial gaps for future use cases were identified that were relevant to this experiment. NAS compliance and GGDM interoperability will align the STE simulation and training semantics with existing use cases for geospatial intelligence and operational use, directly relevant to the Army's goal of "train as you fight." However, unlike the Army Geospatial Center use case for Shapefiles and GeoPackage SQLite tables for point, linear, and polygon features, the OWT use case primarily intends to deploy GGDM attribution attached to 3D content such as triangle mesh models at the mesh level, the vertex level, the triangle level, and applied to model surfaces via raster coverage texturing. The OWT 3D model approach is also relevant to notional glTF mesh layers and geotypical and geospecific models explored in other sections of this Engineering Report. There are similar efforts in NGA - notably the FG3D effort - that are also working toward the integration of 3D content with semantic standards.

=== CDB-X Discussion and Requirements for CDB-X Experimentation

==== Experimentation Background

Migrating the CDB attribution to NAS compliance using GGDM at the initial set of definitions was an early improvement identified for CDB X based on input from current CDB stakeholders over a number of OGC CDB SWG meetings, particularly given that STE One World Terrain was identified as being a desirable interoperability target. Greg Peele, one of the Tech Sprint participants, has described his work as a sub-contractor on the team recommending a Data Model for the U.S. Army One World Terrain (OWT) effort in multiple presentations to the OGC Interopable Simulation and Gaming Domain Working Group.  Greg's most recent - though out of date relative to OWT development and this experiment - OGC presentation entitled *"Entities, Attributes, and Enumerants, Oh My!  Applying GGDM for Interoperable One World Terrain Semantics"* to the ISG DWG may be found here:
https://portal.ogc.org/files/?artifact_id=93666

The GGDM itself is, in practice, a selection of 624 feature types from the NAS 7.0 (with some duplicates for different geometry representation) to meet the mission requirement of outdoor environment representation for the ground warfighter, with a set of associated attribution for each feature type. For attributes with a controlled set of values - also known as enumerants or codelists - the set of values is either explicitly enumerated with integer codes or externally referenced via a separate dictionary of text strings. In principle every GGDM feature type should match up to an NAS 7.0 logical entity, every GGDM attribute should match up to an NAS 7.0 attribute, and every GGDM enumerant should match up to an NAS 7.0 listed value; all of these should then match vocabulary terms defined in the NCV 2.0. In practice, GGDM did augment the NAS with a small number of additional definitions integrated from the NGA Topographic Data Store (TDS) and the US Environmental Protection Agency Water Resource Database (WRDB). 

GGDM adapted the more abstract NAS entity types by binding them to specific geometric representations: Point, Curve (Linear / Line String), Surface (Polygon), and Table (abstract / no geometry). Each such geometric binding shared the same 5-letter FACC-like code as specified by the NAS Platform Specific Model (available a separate file in more recent NAS versions) but suffixed the feature name with an appropriate character 'P', 'C', 'S', or 'T'. The attribute definitions were bound to entity types per entity geometry, so in cases where more than one geometry applied to the same entity type, a particular may be present on one but not the other or on both depending on the specification. In the vast majority of cases GGDM only defined one geometry type per entity type however. The GGDM developers did clarify that an implementation that did not split out entity types by geometry but used some other mechanism to constrain attribute presence and dataset organization by geometry type to align with GGDM requirements would still be considered compliant with GGDM since in both cases the results comply with the NAS logical data model.

GGDM also organized entity types into a "feature index" that specified broader themes or layers such as Hydrography; these themes were also specific to each geometry type. The feature index also defined five levels of detail: Global, Regional, Local, Specialized, and Composite. Each entity type was cross-referenced to specify in which themes the entity belonged to at each level of detail, or to mark that a feature was not represented at a particular of level of detail. This approach to feature organization substantially diverged from the base NAS standard, which instead defined a set of "view groups" (more abstract) and "views" (more specific) to create a two-level hierarchy of entity type organization but did not define any levels of detail. The GGDM feature index themes appear to be related to an older version of the NAS "view groups" but the two are curretly out of sync. Unlike in GGDM, NAS views are non-exclusive so an entity type may belong to more than one view, although one view is typically marked as the primary view for that entity type. In more recent revisions of the NAS such as NAS X-3, the entity to view assignments are available as a separate document from the main content definitions.

One substantial innovation of NAS and GGDM over earlier standards is moving from a flat table-based feature dictionary to a full logical data model compliant with ISO 19109 which allows for multi-valued attributes, range-valued attributes, complex attributes with named sub-fields, and relationships between features. The NAS logical data model expresses these innovations in pure UML without implementation guidance, while the GGDM defines an encoding to represent them in traditional table-based systems.

For multi-valued attributes, GGDM defines a separate attribute code for each value, with the second value and so on suffixing the attribute code with an ordinal index - e.g. for FFN "Feature Function", the first value would be FFN, the second value would be FFN2, the third value would be FFN3, and so on. GGDM sets a max cardinality of 3, but there is no technical reason why more values could not be used in other applications.

For range-valued attributes, GGDM splits them into three attribute values of upper, lower, and interval closure (an enumeration describing whether the lower and upper values are considered part of the range) - for example for WDA "Average Water Depth" you would have WDAL "Average Water Depth <lower bound>", WDAU "Average Water Depth <upper bound>", and WDAC "Average Water Depth <interval closure>" as three separate attributes. This is a replacement for the clumsy approach in DIGEST FACC that used enumerations of a predetermined set of ranges for these attributes instead of explicitly specifying the range numerically.

Finally, for complex aggregate attributes and feature relationships, GGDM defines a scheme to take the logical value relationship as a hierarchy and flatten it into prefixed attributes that combine the datatype or feature type with the target attribute code; GGDM defines this flattening such that no attribute code exceeds 10 characters however so some particularly complex attributes have the prefixed names truncated. An example of a complex aggregate attribute is RIN_RTN "Route Identification <route designation>" - the NAS UML defines Route Identification as a separate class with a Route Designation attribute. An example of a feature relationship expressed as an attribute is ZI006_MEM "Note : Memorandum" which is a reference to a feature of type Note with an attribute value of Memorandum. In some cases the related features are fully embedded in the source feature and thus duplicated for every feature; in others the related feature is referenced by a foreign key using the UFI "Unique Entity Identifer" attribute.

Each of these three cases can also be combined with each other - for example, a multi-valued or range-valued attribute on a related feature, or a chain of multiple aggregated or related features - although doing so tends to quickly hit the 10 character truncation limit for the attribute code. While currently used for Shapefiles and GeoPackage implemetnations, this particular encoding scheme for complex attributes is not strictly necessary to claim GGDM conformance; directly representing multi-valued, range-valued, and complex attributes natively by some other mechanism such as JSON, binary markup, or separate SQL tables would still be considered compliant with the GGDM logical data model and the NAS so long as the attribute semantics remains the same. Also, using the label or natural language name for entities, attributes, and enumerations instead of the FACC-like codes the actual attribute storage would still be considered compliant with GGDM and NAS - this is a physical encoding implementation choice.

Given the historical lineage of the NAS and GGDM, there is a substantial overlap between GGDM and the CDB 1.x Feature Data Dictionary. However, neither standard is a strict superset of the other. NAS and GGDM have changed existing definitions inherited from FACC as well as adding many new definitions. CDB has made substantive changes to add a new concept of "Feature Subcode" that did not exist in prior standards, bring in a different se of definitions from ISO 18025, and add new definitions for aeronautics and building interior components. STE One World Terrain, in particular, had identified gaps in the GGDM standard for building interiors, aeronautics, vegetation, and materials which are all current CDB use cases, so the existing CDB extensions over FACC may end up being complementary to GGDM rather than redundant and may correlate with ongoing standards development in other domains.

==== Experimentation Goals

Given the strong consensus that adopting NAS using the GGDM as a starting point represents the best path forward for CDB X, we planned an experiment to validate this hypothesis and determine what gaps and difficulties this change would introduce, with a particular focus on any changes in CDB storage structure would be implied by moving to GGDM. During the initial Phase 3 of the CDB X Tech Sprint, we created an initial metamodel describing the proposed schema for representing the target GGDM data model and a notional SQLite metadata encoding to store it in a more runtime-efficient way than the current CDB 1.x XML metadata.

The first planned experiment was to create a prototype software code library representing the proposed CBD X feature dictionary metamodel. This prototype would define runtime classes for each of the metamodel concepts and implement a proof of concept reader that could load both the existing CDB 1.x XML feature and attribute dictionary metadata as well as loading the GGDM 3.0 entity catalog as conventionally formatted in an Excel spreadhseet. The prototype would then finally implement proof of concept support for storing the dictionary content in the proposed SQLite metadata encoding, with a stretch goal of also implementing sample XML and JSON encodings for comparison. The primary goal of the first experiment was not necessarily to fully implement all of the capabilities, but rather use the prototype to identify and document any deficiences or mismatches in the proposed CDB X feature dictionary metamodel - ideally with proposed corrections - that would interfere with migrating existing CDB 1.x feature data or representing the proposed NAS-compliant dictionary.

Since CDB 1.x and GGDM have essentially compatible semantics of what an entity (feature) type is, the next phase of the experiment was to assess data model mappings between GGDM, TDS, and CDB to determine how cleanly the existing CDB feature types translate to GGDM feature types and identify any substantial gaps in GGDM as well as mappings that lose precision or involve additional complexity. We are particularly interested in identifying how much of the mapping preserves the existing CDB feature code, feature label, or ideally both. We also planned to use the gaps identified to suggest a mitigation strategy for filling those gaps either using existing CDB 1.x definitions or from other open standards and to examine similar efforts conducted by SE Core and STE One World Terrain. While initial assessments suggested that attribution and enumerant values would likely map mostly directly due to both CDB and GGDM largely pulling from the same FACC ancestry, we also planned to document any mismatches we found regarding attribute values. We planned to review GGDM and NAS entity types and attribution for describing feature-level metadata to propose a possible mechanism to implement that in CDB X. Ideally, as a stretch goal, we planned to adapt the prototype software library developed for the first experiment to use name and code matching to generate an automated mapping to compare with the manual assessment; however, we were unable to meet that stretch goal.

The third "experiment" is more of a thought experiment to coordinate with the tiling, vector features, and 3D model breakout groups to identify what changes to the feature dictionary and data model will imply on changes to structure and content of the CDB datasets - particularly vector and 3D model datasets. This will identify the key areas of standards development for attribution outside of the feature dictionary metadata itself. It may also inspire changes to the CDB dataset structure and content to better align with the target GGDM data model.

=== CDB X Experiment Findings

The three experiments conducted successfully generated a number of findings initially captured as Github tickets. The prototype code library for the feature attribute metamodel was partially implemented to a sufficient degree to identify the mismatches with both the CDB 1.0 feature dictionary and the target GGDM 3.0 data dictionary and provide partial implementation for both the core SQLite encoding and the stretch goal XML encoding, but not the JSON encoding. These results generated substantial interest among the One World Terrain stakeholders to sponsor the completion of the prototype code library targeted at the One World Terrain data model use case. The breakout group reviewed and assessed a number of mappings and reports between GGDM, TDS, and CDB 1.x to capture the major mismatches and findings. However, we did not achieve the stretch goal of using the code library to generate automated mappings for comparison so that experiment remains as future work; we believe this may be a useful technique for approaching the mapping to NAS X-3 and DGIM that we propose as a recommendation. Finally, after substantial discussion on Slack and via Github, we identified the relatively few areas where changing the GGDM data model had a substantive impact on the CDB dataset storage.

==== Entity Metamodel Comparison

The CDB 1.x entity metamodel is overall similar but less complex than the GGDM and NAS entity metamodel; this is to be expected since all of these standards derived from the same FACC metamodel but the NAS and GGDM have undergone substantial development since then to align with current data model practice. NAS and GGDM renamed the "feature" concept to the more general form "entity" to accomodate phenomena that were not traditionally considered features like devices, lifeforms, vehicles, and abstract ideas. However, the basic notion of an entity being a particular phenomenon with a unique identity in the simulated or real world that is described by attributes with particular values is still the same. NAS and NCV explicitly define a semantic ontology hierarchy of entity type subclassing that refines very general and abstract entities into specific entity types, which can be very useful for semantic understanding of complex datasets. This hierarchy is implicit and assumed in GGDM as an application of the NAS rather than explicitly stated. It does not exist at all in CDB 1.x modulo being implicit for a few items brought in from external standards for building interiors and explicitly via the generalizations (more in terms of aggregation than subclassing) specified by the category/subcategory organization of entity types and by feature subcodes.

Both the CDB 1.x and the GGDM represent entity types using a 5-letter code mostly inherited from FACC, although NAS and GGDM have modified some existing codes and both have added new ones. CDB 1.x specifies entities purely semantically and then specifies a recommended geometry type and data set for each entity type, as well as relying on the semantics of the first two letters of the FACC-like 5 letter code to organize entity types into a two-level category hierarchy for 3D model storage. NAS specifies entities purely semantically; entities that do have a physical geometry have an associated attribute that may be a point, curve, or surface value or combination thereof. GGDM specifies entities separately per geometry type using a suffix on the entity name and does specify a theme (data set) for each entity type, albeit separately for each of five levels of detail. GGDM and NAS entities may be related to other entities through associations which is a concept that does not currently exist in CDB 1.x but may prove very useful for data de-duplication, feature-level metadata, and annotation. CDB 1.0 additionally defines a specific semantic concept of feature subcode that does not exist in GGDM and NAS. 

Primitive attributes are also essentially the same conceptually - they describe a particular quantiative or qualitive property of an entity type using a name, a short code, and a data type, a measurement unit for measured quantities, and constraints on the values. In traditional FACC the attribute codes are always 3 characters. CDB added a number of additional attributes with 4 character codes, many of which are related to model instancing. GGDM attributes are typically 3 character codes for simple attributes, however suffixed attributes for multi-valued and range-valued attribute are 4 characters and prefixed attributes for complex data types and feature relationships may be up to 10 characters. The primitive data types of Boolean true/false, integer, real number, text, and (partially) enumeration are essentially the same in both standards, although the multi-valued, range-valued, and complex attribute value types in GGDM do not have an equivalent iN CDB 1.x. While the core concept of attributes is equivalent, the details of constraints, in particular, do vary substantially. Another substantive difference is that attributes are bound to datasets in CDB 1.0 but are bound individually to geometry-specific entity types in GGDM. CDB also has a concept of optional attributes with default values to fill in missing information, whereas all attributes are mandatory in GGDM and no default values exist.

The controlled vocabulary for qualitative attribute values - enumerations, codelists, etc. - is similar conceptually. For closed vocabulary sets, GGDM and CDB 1.x are essentially compatible in that they identify a list of terms and assign them numeric ordinal indices. For open vocabulary sets that reference external standards, GGDM specifies them using text strings either in a separate sheet in the GGDM Excel spreadsheet or through an externally web-accessible registry. CDB 1.x has no equivalent to this kind of text-based codelist and would currently have to store such values a freeform text.

Groupings to organize entity types into datasets, collections, and categories are substantially different between CDB 1.x and GGDM and this difference will need to be reconciled.

One concept that exists explicitly in the NAS but is implicit and not stated in GGDM and CDB 1.x is the notion of physical quantities, which describe the types of measurements that may be made for values. For example, a quantity of "Length" is defined to measure linear distance and the measurement units of "metre" and "foot" are realizations of that quantity. This concept is primarily used to identify which units may be converted to each other and what those conversion factors are.

Based on this comparison, we believe that the metamodel for CDB 1.x currently is mostly a compatible subset of the current NAS metamodel modulo a few mismatches discussed in following sections. We recommend considering extending the current CDB XML metadata to add the NAS metamodel capabilities that are currently not supported and develop a new CDB_Feature_Dictionary.xml and CDB_Attributes.xml (and related files) that capture the NAS-compliant definitions starting from GGDM - we present detailed recommendations in follow-up findings on how to accomplish this goal. Such an approach would enable a backward compatible path to migrating the current standard to NAS compliance using GGDM as the encoding mechanism to deal with complex attribution so no structural changes to CDB 1.x vector encoding are needed. However, we also recommend developing for the full CDB X major revision a replacement database metadata strategy that encapsulates the entire data model and data dictionary in a single SQLite file that will be easier for runtime clients to use and query at runtime, especially since clients will be expected to have SQLite support anyways if GeoPackage is the vector dataset encoding, and to develop natie repsentations of complex attributes that may not necessarily need the GGDM encoding approach.

==== Feature Subcodes not in GGDM

One very concrete difference between CDB 1.x and GGDM is that CDB 1.x defines a built-in concept of "Feature Subcode" in addition to the normal "Feature Code" specifying the 5-letter code. This feature subcode is, in practice, stored as a separate attribute in the vector attribution table and is an integer value of up to three digits describing a specific subtype of the broader feature type. The introduction of feature subcodes was a substantial change from the originating FACC standard and no other standard we assessed uses this concept; http://ogc.standardstracker.org/show_request.cgi?id=544[OGC CDB ticket 544] highlights that using feature subcodes does not comply with ISO 19109 or the NAS. Relatively few CDB feature types use feature subcodes; however, the ones that do tend to be highly relevant such as power plants, buildings, vegetation, and building interior components.

Based on assessment, many but not all of the CDB subcodes originated from different FACC enumerated attributes playing a more specialized role. For example, the subcodes for AD010 "Power_Plant" are directly traceable to the values of the POS "Power Source" attribute which still exist on the GGDM AD010 "ELECTRIC_POWER_STATION_P" although CDB defines some additional values that are not present in FACC or GGDM such as "Solar", "Wind", and "Internal_Comb". In some cases very general attributes such as FFN "Feature Function", PPO "Physical Product", MFY "Medical Facility Type", and so on are used to make these distinctions in GGDM particularly in regards to buildings and structures. Due to the lack of definitions for individual vegetation objects and building interior components in GGDM - as previously identified by STE One World Terrain - the CDB 1.0 feature subcodes for these types are objects are novel and have no counterpart in GGDM.

CDB X cannot include the concept of feature subcode and remain compatible with GGDM, NAS, OWT, or ISO 19109. A mapping strategy will need to be defined and missing semantic definitions will need to be added to the CDB X extension of GGDM, ideally formulated using NCV vocabulary so it can be submitted back to the developers of GGDM and NAS for inclusion in future revisions of those standards. We recommend treating the CDB 1.x feature subcode conceptually as an attribute - purely for mapping purposes - rather than its own concept, whose valid enumerated values are different depending on the entity type. Where possible, this attribute should be mapped to existing GGDM or NAS attributes such as POS, FFN, and PPO. In cases where an appropriate attribute exists but not all feature subcodes have valid mappings, we recommend adding new enumerant values to represent those concepts using the existing CDB 1.0 definitions. In cases where appropriate attributes or entity types do not already exist in GGDM or NAS, additional decisions need to be made. We believe looking at other standards would be the best first choice - the DGIM and its referenced standards IHO S-100 and AIXM may provide substantial definitions for maritime and aeronautics, for example. In the event that no open standard provides suitable definitions, the first decision is whether to create separate entity types for each subcode definition if they are sufficiently different from each other - and these can be still be related by subclassing relationships at the logical level as is done in the NAS - or to create a single entity type encompassing all of them and then defining an enumerated attribute to represent the possible feature subcodes. Building interiors merit a separate discussion due to the complexity and role other external standards such as IFC/BIM, CityGML, IMDF, and others play.

It would be possible to perform this change in a structurally backward-compatible way without changing the schema of the current CDB 1.x XML metadata standard. This approach could be done by simply not using feature subcodes - or more accurately, only ever using feature subcode "000" to avoid breaking the parsing structure - when writing the replacement Feature_Data_Dictionary.xml that captures the NAS-compliant and extended entity types that replace the feature subcodes. Replacement attributes used to map feature subcode would also have to be added to CDB_Attributes.xml file. Once this is in place, feature subcodes could be deprecated, but not removed until CDB X. For CDB X, we recommend simply not including feature subcode as a concept at all and map CDB 1.x databases using feature subcode as a codelist or enumeration attribute.

==== Mapping between CDB, TDS, and GGDM

We reviewed sets of link:Experiments/Attribution/GGDM_to_CDB_Crosswalk_20200713.xlsx[existing mappings between NGA TDS 6.0, TDS 7.0, GGDM 3.0, and CBD 1.0] that had been developed by Cognitics, Inc. and others to assess the completeness of the mapping from CDB 1.0 to GGDM 3.0 primarily focused on entity type and attribute mappings.

The primary findings for entity types is that out of roughly 2,000 CDB entity types (including distinct subcodes) approximately 30% of them have a direct and obvious mapping to GGDM 3.0. Of this 30% that do have obvious mappings, almost all of them either match on 5-letter code, on entity name (ignoring case and geometry suffix), or frequently both due to shared lineage from FACC. Some very common entity types did change either code or name between CDB and NAS/GGDM - for example AL015 is Building in CDB but it's AL013 in NAS and GGDM, whereas AD010 is "Power Plant" in CDB and "Electric Power Station" in NAS and GGDM - so it's not accurate to say CDB is a subset or superset of NAS or GGDM in terms of names, codes, or definitions.

Of the 70% of CDB feature types that did not immediately map to GGDM, the majority are various specific types of buildings and structures that CDB represents as unique entity types or feature subcodes than does NAS or GGDM. In GDDM, many of these concepts are handled as a more generic AL010 Facility, AL013 Building, AH055 Fortified Building, or similarly generic entity type with one or more attribution values specifying the details. We believe these mappings do at least partially exist - perhaps even for a majority of the entity types - but will require substantial effort to develop and cross-reference to ensure the semantics are compatible and that missing values are added since it is not a straightward name-based match.

There are also substantial gaps in the GGDM data model for particular categories present in CDB 1.x. Most broadly, GGDM lacks any representation for individual vegetation objects (other than EC005 "Tree") and any representation for building interior components except for a handful that also can exist standalone in the outdoor environment. GGDM also lacks any definition of detailed material composition or aeronautically-rigorous light points, although CDB 1.x handles materials and light points as separate conceptual things that are not part of the CDB feature dictionary. Other areas where there are some gaps include climate zones and biomes, detailed aeronautics, detailed maritime features and port structures, and fighting positions and other military-related dynamic terrain obstacles. In retrospect, most of these gaps should be expected because of GGDM's specific mission to apply the NAS to the specific needs of the outdoor environment for the ground warfighter, although the lack of infantry-relevant fighting positions and dynamic terrain obstacles is a little surprising given that mission.

The latest version of the full NAS (currently NAS X-3) provides definitions for many but not all of these gaps so our main recommendation is to revisit mapping CDB 1.x to the latest full NAS X-3 rather than the GGDM subset to capture the true coverage of the mapping - this approach will also ignore geometry mismatches since the NAS does not separate entity types by geometry. Domains that we know for sure the NAS X-3 does not cover is building interiors and individual vegetation; these will require a separate approach synthesizing findings of multiple existing civilian standards. Maritime definitions not present in the latest NAS may instead be available in DGIM courtesy of IHO S-100. Aeronautics definitions definitions not present in the latest NAS may instead be available in DGIM courtesy of AIXM. The unmet stretch goal of updating software to provide fully automated mappings as a starting point will likely be very useful to such a follow up experiment if a suitable NAS and DGIM loader is written.

For attribution, the situation is a bit more straightforward in most cases. CDB has a very limited selection of 66 attributes relative to much larger GGDM and NAS; the migration to NAS will allow for much more detailed semantic representation of the environment with 1,942 different unique attributes at the cost of higher resource use when actually used. For attributes with built-in meaning to the CDB structure itself, they primarily did not map to anything in GGDM or NAS; examples primarily related to model instancing and topology connections such as BBH "Bounding Box Height" as well as the CMIX "Material Identifier" and CNAM "Class Name" foreign keys. This is to be expected and these attributes will likely remain unique to CDB, although the model instance and material attribution may have some synergy with the visual data model being developed for STE OWT.

Most of the remaining attributes had straightforward mappings from CDB 1.x to GGDM due to the shared FACC lineage. However, one unexpected quirk is that many measured attributes in FACC were integer attributes with very limited (one meter or one degree) precision with alternate attributes specifying real values to full precision; CDB went with the latter for obvious reasons of accuracy. NAS and GGDM amended FACC to change all the integer-valued measured attributes into real-valued attributes to capture the proper intended semantics, and removed all of the alternate forms. Examples include AOO "Angle of Orientation" vs. CDB using AO1 "Angle of Orientation with greater than 1 degree resolution" and WID "Width" vs. CDB using WGP "Width with Greater Than 1 meter Precision". The NAS changes in this regard make sense and simplify the data model to how many vendors were already using it in practice. While it does not affect CDB mapping, similar changes were made in CDB to remove the alternate FACC attribute forms that specify measurements in non-SI units; the NAS instead provides a set of quantity and measurement definitions to allow implementations to store measurements in any unit if desired while specifying the standard unit for each attribute. The main exception is for the few cases such as SPD "Speed Limit (MPH)" vs. SPM "Speed Limit (KPH)" where the distinction between the units is legally or semantically relevant and not just a measurement detail.

Summarizing the methodology we propose for mapping CDB to a NAS-compliant data model:
. Start with existing CDB 1.0 to GGDM mapping to identify core set of compatibility for outdoor environment (revisit attribute based mappings for subcodes)
. Conduct full mapping from CDB 1.0 to NAS X-3 or newer to capture NAS compliant mappings and document NAS gaps
. Conduct mapping to DGIM followed by IHO S-100 for maritime gaps in mappings to NAS, develop NCV definitions for these gaps
. Conduct mapping to DGIM followed by AIXM for aeronautics gaps in mappings to NAS, develop NCV definitions for these gaps
. Coordinate with OGC CityGML, STE OWT, and other stakeholders to synthesize a building interior data model and develop NCV definitions for these gaps
. Coordinate with STE OWT and civilian environmental agencies to synthesize a detailed vegetation data model and develop NCV definitions for these gaps
. Any remaining gaps will require new semantic development to create NCV vocabulary and frame in NAS compliant logical model

We recommend not just capturing the new NAS-compliant definitions into a new CDB_Feature_Dictionary.xml, but also defining a ruleset format in XML or some other easy to use encoding - possibly leveraging technologies like ShapeChange - for defining the translation rules from CDB 1.0 feature dictionary to the NAS-compliant feature dictionary in a reproducible way. While most translation rules will be a simple 1:1 mapping from feature type to feature type, some will rely on conditional mappings of values for feature subcode or other attribute values and a few are fairly specific. This particular approach could also be used to develop other sets of standardized data model mappings from or to ISO 18025, vanilla DIGEST FACC 2.1, or different versions of NAS or DGIM to improve the migration path of interoperabillity between data sets.

==== Existing FDD Metadata Missing Attribute Details

The existing CDB 1.x standards specify more details in the feature and attribute dictionaries as human-readable descriptions and graphics than are actually present in the machine-readable XML. These details are relevant in migrating to the NAS-compliant attribution model and it is unreasonable to expect clients to hard-code them based on reading the specification. The two key items that are missing at the machine-readable level for the current standard are the definitions of which attributes should be present on each dataset and the list of valid enumerant values for each attribute. Both of these gaps can be filled in a straightforward backward-compatible way by adding XML elements to existing metadata as a minor revision in CDB 1.3 or beyond.

For linking attributes to datasets, this could be organized either by specifying a list of datasets under each attribute in the in the CDB_Attributes.xml, or by specifying a list of attributes under each dataset in the Datasets.xml. In either case, this linkage would also be modified by an element s pecifying whether the attribute's presence is "Mandatory", "Preferred", "Optional", or "Deprecated" to match the existing CDB 1.x human-readable specification.

For defining enumerants, we recommend adding an <Enumeration> element under the <Value> element in the CDB_Attributes.xml and for each valid enumerant value, add a <Term> element that specifies the name/label, the integer code, and the full definition/description. The set of valid enumerants for each attribute is already defined in the CDB 1.x specification, it just needs to be captured in this XML. 

==== Grouping Features into Datasets and Categories

One sustantial metamodel difference how entity (feature) types are organized into datasets and categories. CDB 1.0 currently provides two different ways of organizing entity types that are used in unrelated ways. 

The first, relying on the two-letter prefixes of the FACC-like codes specified in the Feature_Data_Dictionary.xml metadata file, organizes entity types into categories and subcategories. For items derived from FACC, this organization generally is semantically coherent in which similar or related entity types end up in the same category. The same is generally less true for entity types in CDB that were not derived from FACC; such extensions, particularly the entity types starting with 'U' and 'V', tend to be more organized by origin of definition than by semantics although the subcategory usually still provides some semantic grouping. The category/subcategory grouping is used primarily to decide folder paths and file names for 3D models.

The second, specifying separately in the Datasets.xml metadata file, organizes entity types into separate datasets (layers) which then in CDB 1.0 imply different files and file formats for each dataset. The datasets represent both raster coverages such as Elevation as well as 3D model data sets and vector datasets; the vector data sets can then be further implemented as point, linear, and polygonal sublayers. This concept of grouping is core to the current CDB 1.0 standard and dictates filenames, formats, and content. As a substantial divergence from GGDM, the CDB 1.0 standard specifies the list of valid attributes at the dataset level rather than for each entity. CDB X may relax the storage organization impact due to experiments with GeoPackage containerization, but the groupings may still affect internal tables in the GeoPackage.

NAS and GGDM do not exactly have equivalent concepts to either one of the CDB 1.0 grouping types. The closest concept in NAS is the concept of "view groups" and "views" which are a two-level hierarchy of organization of entity types. Entity types may belong to more than one view, and each view may only belong to one view group. The two-letter FACC-like prefixes in NAS do not have any normative meaning since they are defined by a separate "Platform Specific Model" rather than being a core part of the entity type definition, although in practice new entity types in NAS still select 5-letter codes in a way that mostly maintains semantic groupings based on the first two letters. The closest concept in GGDM is the feature index, which is recognizably similar to the NAS view groups but not consistent with them, but are geometry specific.

The original design from Phase 3 only accounted for NAS view groups and views as a replacement for category and subcategory - assigning each entity type only to its primary view - but the experimentation showed this was insufficient to model CDB 1.0 due to the core role datasets play in the CDB storage layout and attribution. The fact that attributes are specified at the dataset level is a curve ball; in NAS only entities may conceptually have attributes, not containers or groupings, which made the initial design insufficient to migrate CDB 1.x databases into the new logical model.

Going back to the most abstract level - the NCV - gave some insight on how to reconcile this mismatch. At that level, every definition is simply a vocabulary term, with containers being just a different type of term that can have children. This is not exactly what we needed, but we realized that combining that with a concept of relationships from the NAS would enable us to generalize containers such as datasets to also be entities. 

So the specific recommendation to map CDB 1.x to the NAS conceptual model is as follows:
. Define entity types that represent each dataset and associate the relevant attributes to each dataset as described in the prior section
. Add a "generalization" relationship from each dataset to NAS entity type ZI031 "Dataset"
. Define entity types for each category and subcategory
. Add an "aggregation" relationship from entities to datasets that contain them
. Add an "aggregation" relatioship from entities to their containing subcategory
. Add an "aggregation" relationship from subcategory to its containing category

In CDB 1.x all of these constructs would be implicitly set up by the definition of the Datasets.xml and Feature_Data_Dictionary.xml, whereas in CDB X these could be explicitly represented in the data model SQLite storage and logical model.

In CDB X, we recommend the NAS-compliant replacement to do the following:
. Define entity types that represent each dataset, aligning with NAS/NCV where possible
. Define attributes for each entity type as specified by NAS and GGDM
. Add a "generalization" relationship from each dataset to NAS entity type ZI031 "Dataset"
. Use the existing NAS view groups and views as the replacement of category and subcategory, defined as entity types
. Add an "aggregation" relationship from entities to datasets that contain them

As part of a backward-compatible change to CDB 1.x, we recommend adding an <Aggregation> element sequence to the current <Subcode> element to allow specifying additional containers for entity types beyond the category, subcategory, and dataset containers implied by the current structure. This will provide a migration path to generally specifying of arbitrary depth of views and containers compliant with ISO 19109. We also recommend adding a <Generalization> element to each <Subcode> element to capture the parent/child subclassing relationship for entity types defined by NAS.

==== Per-Entity vs. Per-Dataset Attributes

As explained in the previous section about feature groupings, one divergence of CDB vs. NAS and GGDM is that CDB 1.x defines which attributes are valid at the dataset level, whereas NAS and GGDM define the set of valid attributes and their associated constraints specifically for each entity type (and in GGDM, unique for each geometry type). To migrate toward NAS compliance, CDB X will need to specify the set of valid attributes per entity type. The previous sections proposes a recommendation of how to adapt the existing per-dataset attribute definitions to the proposed CDB X conceptual model to maintain backward compatibility.

However, the inverse can also be done: extend the CDB_Feature_Dictionary.xml to add a new XML <Attributes> element under the existing <Feature_Type> element to list the set of valid attributes for that particular entity type referencing the definitions present in CDB_Attributes.xml. Each such element could include an optional XML modifier for each attribute to specify that the attribute only applies to a particular geometry type to represent GGDM geometry-specific constraints. Another XML modifier could apply the same "Mandatory", "Preferred", "Optional", or "Deprecated" status as currently prescribed for linking attributes to datasets. This <Attribute> element could also specify the same set of constraints such as range, precision, etc. to override the global definition for that specific feature type, although in practice most will probably just use the global definition.

This recommendation would enable implementing NAS-compliant per-entity attribution constraints within the current CDB 1.x structural framework via backward-compatible extensions while allowing the prior per-dataset definitions to remain in place as a deprecated element while clients migrate, which can then be fully retired in CDB X as a breaking change. The global attribute definitions are still useful from an NCV deep semantics standpoint of capturing which attributes across different entity types have the same semantic meaning.

==== Mandatory vs. Optional Attributes and Default Values

==== Multi-Valued Attributes

==== Range-Valued Attributes

==== Text Patterns and Codelists

==== Instance, Class, and Extended Attributes

==== Metadata vs. Attribution

==== CDB Vector Geometry Data Model vs. Other OGC Standards

==== Entity Dictionary Storage Design

==== Organizing Attributes by Domain

==== Data Dictionary Versioning, Changes, and Extensions

==== Impacts of Attribution Changes on Vector Encoding

==== Impacts of Attribution Changes on 3D Models

==== Relationship to Light Points

==== Relationship to Materials

==== Building Interior Considerations

=== Summary of Recommendations
* Adopt NAS-compliant logical entity-attribute model for CDB X with extensions for CDB use cases
** Store all aspsects of feature and attribute dictionary in single SQLite file for portability and runtime performance
** Use GGDM 3.0 as the initial starting point for definitions to populate CDB X data dictionary
** Match up remaining CDB non-GGDM feature types and subcodes with latest NAS definitions where possible, matching subcodes to attributes where relevant and adding missing enumerant values where necessary (with associated NCV vocabulary)
** Augment NAS definitions with other open standards and new development
*** Match up missing maritime definitions to DGIM followed by IHO S-100 where possible, define NCV vocabulary for such integrated definitions
*** Match up missing aeronautics definitions to DGIM followed by AIXM where possible, define NCV vocabulary for such integrated definitions
*** Coordinate with NGA, STE OWT, and OGC to develop replacement building interior data model incorporating IFC/BIM, CityGML, IMDF, and other open standards
*** Coordinate with NGA, STE OWT, and civilian environment agencies to develop detailed data model for vegetation
*** Create data model and vocabulary for material and light point definitions and capture into existing material and lightpoint libraries
*** Define NCV vocabulary and NAS-compatible entity and attribute types for CDB feature types and subcodes totally missing in all other standards
** Remove CDB feature subcodes entirely; migrate to existing and new feature and attribute types instead in NAS-compliant structure
** Define entity types for CDB datasets and define "aggregation" relationships from feature types to containing datasets
** Capture feature-level, dataset-level, and database metadata as NAS-compliant attribution meeting the NSG Metadata Foundation (NMF)
** Define functional role domains and create mechanism to organize attribution by domain for tailoring to runtime devices
* Delegate entity and attribute physical encoding choices to vector and 3D model containers instead of specifying globally
** Deprecate extended attributes entirely, to be removed in CDB X
** Delegate containerization of entity types (one per table, multiple in same table specified by F_CODE attribute, etc.) to vector and model containers
** Delegate decision whether to use class or instance attributes to individual vector and model containers rather than global data dictionary
** Delegate decision of whether to use FACC-like codes, NAS labels, or natural language names for entity types, attributes, and values to vector and model containers
** Delegate decision of whether to flatten complex feature relationships and attributes used GGDM attribute prefixing to vector and model containers
** Delegate decision of whether to flatten multi-valued and range-valued attributes using GGDM attribute prefixing to vector and model containers
** Specify minimum and maximum cardinality of multi-valued attributes in feature and attribute dictionary, allow containers to use a lower maximum if using GGDM attribute prefixing encoding
* Define backward-compatible extensions in CDB 1.3 to add constructs necessary to move toward NAS-compliant attribution
** Capture proposed NAS-complaint replacement feature dictionary in existing CDB metadata XML with necessary extensions
** Only use feature subcode 000 in replacement dictionary and deprecate use of feature subcodes to be removed in CDB X
** Add mechanism to mark numeric attributes as interval ranges (existing non-upgraded clients should see still attribute as single-valued and read mean value from associated content)
** Add minumum and maximum cardinality elements for all attribute definitions to specify mininum and maximum element count for multi-valued attributes (existing non-upgraded clients should just see attribute as scalar base value and will only read the first value from associated content)
** Add list of valid attributes to datasets in CDB 1.x metadata XML files to match existing human-readable specification
** Add list of valid enumerants for each attribute in CDB 1.x CDB_Attributes.xml file to match existing human-readable specification
** Add list of valid attributes for each entity type as extension to CDB 1.x Feature_Data_Dictionary.xml to implement NAS-compliant per-entity attributes
** Update CDB 1.x CDB_Attributes.xml to allow specifying text pattern constraints through <Pattern> element and text codelists for text attributes via <Codelist> element
** Update CDB 1.x Feature_Data_Dictionary.xml for each feature to specify its generalization (base) entity type via <Generalization> element
** Update CDB 1.x Feature_Data_Dictionary.xml to add <Aggregation> element to define additional associated category for an entity type, or parent category for a category
** Existing category and subcategory XML structure will add implicit definitions and aggeregation links for the category/subcategory items as used by CDB 1.0 for model storage

==== Phase 3, Day 3

[#img_Peele_Whiteboard_Day_3,reftext='{figure-caption} {counter:figure-num}']
.Greg Peele's Whiteboard from Phase 3 Day 3.
image::images/Greg Peele Day 3 whiteboard.png[width=1000,align="center"]

==== Phase 3, Day 4

[#img_Attribution-in-GGDM-prove-me-wrong,reftext='{figure-caption} {counter:figure-num}']
.'Attribution will be in GGDM, Prove me Wrong' Day 4 Sign.
image::images/Day 4 Attribution in GGDM Prove me Wrong sign.png[width=500,align="center"]

[#img_Attribution-Day-4-Whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 4 Whiteboard.
image::images/Attribution Day 4 Sub Team Whiteboard 1.png[width=1000,align="center"]

==== Phase 3, Day 5

[#img_Attribution-Day-5-WIP1-Whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 5 Work in Progress Whiteboard One.
image::images/Day 5 Attribution Whiteboard WIP1.png[width=1000,align="center"]

[#img_Attribution-Day-5-WIP2-whiteboard,reftext='{figure-caption} {counter:figure-num}']
.Attribution Day 5 Work in Progress Whiteboard Two.
image::images/Day 5 Attribution Whiteboard WIP2.png[width=1000,align="center"]
